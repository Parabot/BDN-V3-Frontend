- pipeline: "Production"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "master"
  actions:
  - action: "Execute: gulp build"
    type: "BUILD"
    docker_image_name: "library/node"
    docker_image_tag: "6"
    execute_commands:
    - "# Working directory with cloned repository: /bdn-v3-frontend"
    - "# Click the link at the bottom for more options"
    - "npm install"
    - "bower install --allow-root"
    - "npm rebuild node-sass"
    - "gulp build-deploy"
    setup_commands:
    - "# Executed on the first pipeline execution only"
    - "# Popular use case: install packages required by your Run Commands"
    - "# Changing the image in the Environment tab will run the commands again"
    - "npm install -g yo bower gulp"
  - action: "Upload files to server"
    type: "SFTP"
    input_type: "BUILD_ARTIFACTS"
    local_path: "./dist"
    remote_path: "/home/devparabot/public_html"
    login: "devparabot"
    host: "host.parabot.org"
    port: "22"
    authentication_mode: "PUBLIC_KEY"
  - action: "Send notification to deployments channel"
    type: "SLACK"
    content: "Deployment of ${execution.pipeline.name} executed successfully with id #${execution.id}"
    channel: "C0A4D1VK8"
    attachments:
    - "{\"fallback\":\"${execution.pipeline.name} execution #${execution.id}\",\"color\":\"good\",\"fields\":[{\"title\":\"Successful execution\",\"value\":\"<${execution.html_url}|Execution #${execution.id} ${execution.comment}>\",\"short\":true},{\"title\":\"Pipeline\",\"value\":\"<${execution.pipeline.html_url}|${execution.pipeline.name}>\",\"short\":true},{\"title\":\"Branch\",\"value\":\"${execution.pipeline.name}\",\"short\":true},{\"title\":\"Project\",\"value\":\"<${project.html_url}|${project.name}>\",\"short\":true}]}"
    integration_id: 13035
  - action: "Send notification to deployments channel"
    type: "SLACK"
    trigger_time: "ON_FAILURE"
    content: "Deployment of ${execution.pipeline.name} executed incorrectly with id #${execution.id}"
    channel: "C0A4D1VK8"
    attachments:
    - "{\"fallback\":\"${execution.pipeline.name} execution #${execution.id}\",\"color\":\"danger\",\"fields\":[{\"title\":\"Failed execution\",\"value\":\"<${execution.html_url}|Execution #${execution.id} ${execution.comment}>\",\"short\":true},{\"title\":\"Pipeline\",\"value\":\"<${execution.pipeline.html_url}|${execution.pipeline.name}>\",\"short\":true},{\"title\":\"Branch\",\"value\":\"${execution.pipeline.name}\",\"short\":true},{\"title\":\"Project\",\"value\":\"<${project.html_url}|${project.name}>\",\"short\":true}]}"
    integration_id: 13035
